---
import { APP_NAME, NAV_LINKS } from '../lib';
import HeaderSidebar from './HeaderSidebar.astro';
---

<header
	class="header"
	role="banner"
	transition:persist
>
	<div class="container mx-auto px-4 flex justify-between items-center h-[72px]">
		<a
			class="text-lg font-semibold text-foreground hover:text-primary transition-colors"
			href="#home"
			aria-label="Home"
		>
			{APP_NAME}
		</a>
		<nav
			class="nav hidden md:block"
			aria-label="Main navigation"
		>
			<ul class="nav-list flex items-center gap-8">
				{NAV_LINKS.map(link => (
					<li>
						<a
							class="nav-link"
							href={link.href}
							aria-label={`${link.name} section`}
							data-section={link.href.replace('#', '')}
						>
							{link.name}
						</a>
					</li>
				))}
			</ul>
		</nav>
		<HeaderSidebar />
	</div>
</header>

<script>
	function initHeader() {
		// Smooth scroll for anchor links
		document.querySelectorAll<HTMLAnchorElement>('a[href^="#"]').forEach(anchor => {
			anchor.addEventListener('click', (e) => {
				e.preventDefault();
				const href = anchor.getAttribute('href');
				if (!href) return;
				
				const target = document.querySelector(href);
				if (target) {
					const headerHeight = 72;
					const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - headerHeight;
					
					window.scrollTo({
						top: targetPosition,
						behavior: 'smooth'
					});
				}
			});
		});

		// Active nav link highlighting
		const sections = document.querySelectorAll('section[id]');
		const navLinks = document.querySelectorAll('.nav-link[data-section]');

		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					const sectionId = entry.target.getAttribute('id');
					navLinks.forEach(link => {
						link.classList.remove('active');
						if (link.getAttribute('data-section') === sectionId) {
							link.classList.add('active');
						}
					});
				}
			});
		}, {
			rootMargin: '-20% 0px -80% 0px',
			threshold: 0
		});

		sections.forEach(section => observer.observe(section));
	}

	// Run on initial load
	initHeader();

	// Re-run after View Transitions navigation
	document.addEventListener('astro:after-swap', initHeader);
</script>
